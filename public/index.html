<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–¢–∞–π–º–µ—Ä</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; margin: 0; padding: 20px; }
        button { padding: 10px 15px; font-size: 16px; border: none; background: #007bff; color: white; cursor: pointer; border-radius: 8px; margin: 10px; }
        #hacks-list { margin-top: 20px; }
        .hack-item { display: flex; justify-content: space-between; padding: 10px; background: #f5f5f5; border-radius: 5px; margin-top: 5px; }
        .chat-box { display: none; margin-top: 20px; padding: 10px; background: #f5f5f5; border-radius: 5px; }
        input, select { padding: 5px; margin-top: 5px; }
    </style>
</head>
<body>

    <h2>‚è≥ –¢–∞–π–º–µ—Ä</h2>
    <p id="timer">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
    <button id="goButton">GO</button>
    <button id="assistantButton">–ü–æ–¥–∫–ª—é—á–∏—Ç—å –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞</button>

    <div id="hacks-list"></div>

    <div id="hack-modal" style="display: none;">
        <h3>–°–æ–∑–¥–∞—Ç—å –•–∞–∫</h3>
        <input id="hack-input" type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ü–µ–ª—å">
        <select id="hack-duration">
            <option value="1800000">30 –º–∏–Ω—É—Ç</option>
            <option value="3600000">1 —á–∞—Å</option>
            <option value="86400000">1 –¥–µ–Ω—å</option>
            <option value="604800000">1 –Ω–µ–¥–µ–ª—è</option>
            <option value="2592000000">1 –º–µ—Å—è—Ü</option>
            <option value="157680000000">5 –ª–µ—Ç</option>
        </select>
        <button id="saveHack">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </div>

    <div id="chat-box" class="chat-box">
        <h3>üí¨ –ß–∞—Ç —Å –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–º</h3>
        <input id="chat-input" type="text" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...">
        <button id="sendMessage">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        <p id="chat-response"></p>
    </div>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();

        let hacks = [];

        document.getElementById("assistantButton").addEventListener("click", () => {
            document.getElementById("hack-modal").style.display = "block";
        });

        document.getElementById("saveHack").addEventListener("click", () => {
            let text = document.getElementById("hack-input").value;
            let duration = document.getElementById("hack-duration").value;
            let deadline = Date.now() + parseInt(duration);
            hacks.push({ text, deadline });

            updateHacksList();
            document.getElementById("hack-modal").style.display = "none";
        });

        function updateHacksList() {
            let list = document.getElementById("hacks-list");
            list.innerHTML = "";

            hacks.slice(-3).forEach((hack, index) => {
                let diff = hack.deadline - Date.now();
                let hours = Math.floor(diff / (1000 * 60 * 60));
                let minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                let seconds = Math.floor((diff % (1000 * 60)) / 1000);

                let div = document.createElement("div");
                div.className = "hack-item";
                div.innerHTML = `<span>${hack.text}</span> <span>${hours} —á. ${minutes} –º. ${seconds} —Å.</span>`;
                list.appendChild(div);
            });
        }

        setInterval(updateHacksList, 1000);

        document.getElementById("sendMessage").addEventListener("click", async () => {
            let message = document.getElementById("chat-input").value;
            let response = await fetch("/api/chat", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ userId: tg.initDataUnsafe?.user?.id, message })
            });
            let data = await response.json();
            document.getElementById("chat-response").innerText = data.message;
        });

    </script>

</body>
</html>